language: cpp

sudo: required

matrix:
  include:
  # Linux builds
  - os: linux
    compiler: gcc
    dist: trusty
    before_install:
      - sudo add-apt-repository ppa:librepilot/tools -y
      - sudo apt-get update -q
      - sudo apt-get install -y libc6-i386 libudev-dev libusb-1.0-0-dev libsdl1.2-dev python libopenscenegraph-dev libosgearth-dev qt56-meta-minimal qt56svg qt56script qt56serialport qt56multimedia qt56translations qt56tools
      - make build_sdk_install

  # OSX build
  - os: osx
    compiler: clang
    before_install:
      - brew update
      - brew install curl
      - brew install p7zip
      - brew install gnu-tar
      # - brew install cmake
      - brew outdated gdal || brew upgrade gdal
      - brew outdated geos || brew upgrade geos
      # - brew install sdl sdl_image sdl_mixer
      # - sdl-config --version
      # - sdl-config --cflags
      # - sdl-config --libs
      - brew install ccache
      - export PATH="/usr/local/opt/ccache/libexec:$PATH"
      - ccache -V
      - brew install qt5
      - brew link --force qt5
      - make arm_sdk_install
      - make osg_install
      - make osgearth_install
      - wget https://www.libsdl.org/release/SDL-1.2.15.dmg
      - hdiutil attach SDL-1.2.15.dmg
      - sudo cp -r /Volumes/SDL/SDL.framework /Library/Frameworks/
      - hdiutil detach /Volumes/SDL
      - ls -l /Library/Frameworks/


script:
      - make config_new CCACHE=ccache
      - if [[ "$TRAVIS_TAG" != "" ]]; then
           make -j2 all_flight
           make -j2 fw_resource
           make -j2 gcs
        else
           make -j2 package
        fi
      
git:
        depth: 500

cache: ccache

deploy:
  provider: releases
  api_key:
    secure: FDxOrM2jMsswdMdHbecRXi7pCSQdsQWZajNhcmJHgm36FGgDCr7/GDXJ9k7ZUxdlhDR13K5itkAy6ppZ/dF17lqdLRlANOJp7GEvqm02V0cVBYnyznCXaRejjF5yemScipL9TOPCmWpKYZnzCHhrfghA9LSrJnaRrqR2ExvRfa56zIQUXEas3WutHDR9bYWFrq2O8Kgsxxi68HB3sVDruuEwxbY662KRdaK8FiLzki2wbl0SuFyoX5Tz116/dGTL3Z1zL7kEM17MGeYDjC3SyEod3ov2AMEZwGDwA0wdvk0T919KUe7ZJodi5A+14Kq+1UuIkqXCjCA75KD1geXDwpM8q1ImkfxROWMuHvOyoWWSuu97PfBLf+fe/3UUmZaYa1W71BImGaHj2osAG8AX0p3ZFo8aJiS4xhMhrwaqXq4VDDjKjHgSkRxtGfK+0Tq0iuk9Hu0BaRQu5sGIfLMNMJ3VWDaIG33AcYscKqP8FzZoocAXElBzVe9PtcNaHbT820X4ikKLI+lRDY/SvHKUlEIIqB3/MB/+eSjZfjyV36/EB4uGXCUfxBiqSa4QKKxZysu8VxGhzlS2LJDloCMUtRu0Jn1SNltVqIk0NVUf2Uu2LgH8C89CFXXEoDvspAlhZkx2Pk1OWaYohPGENcGTof9onjev4PoFQCSUc3jiZWk=
  file: build/LibrePilot*
  on:
    repo: f5soh/LibrePilot
    branch: OSX_Travis

